# Saxo OpenAPI Configuration
# See docs/SAXO_MIGRATION_GUIDE.md for setup instructions

# Environment (SIM or LIVE)
SAXO_ENV=SIM

# API Base URLs
SAXO_REST_BASE=https://gateway.saxobank.com/sim/openapi
SAXO_AUTH_BASE=https://sim.logonvalidation.net

# ============================================================
# AUTHENTICATION - Choose ONE of the following modes:
# ============================================================
# 
# IMPORTANT: Configure ONLY ONE mode (not both) to avoid authentication conflicts.
#
# MODE 1: OAuth (Recommended - automatic token refresh, runs indefinitely)
# -------------------------------------------------------------
# Uncomment and configure these three variables for production use:
# SAXO_APP_KEY=your_app_key_here
# SAXO_APP_SECRET=your_app_secret_here
# SAXO_REDIRECT_URI=http://localhost:8765/callback
#
# After configuring OAuth, run: python scripts/saxo_login.py
# Pros: Tokens refresh automatically, runs indefinitely
# Cons: Requires initial setup and browser authentication

# MODE 2: Manual Token (Testing only - expires in 24 hours)
# -------------------------------------------------------------
# Uncomment and set this ONLY for quick testing (not recommended for production):
# SAXO_ACCESS_TOKEN=your_24h_sim_token_here
#
# Pros: Quick setup for testing
# Cons: Expires after 24 hours, requires manual regeneration
# Note: If using OAuth, ensure this is NOT set (or set to empty string)

# ============================================================
# WATCHLIST (Optional)
# Provide a structured watchlist as JSON (AssetType + UIC)
# WATCHLIST_JSON=[{"symbol":"AAPL","asset_type":"Stock","uic":211},{"symbol":"BTCUSD","asset_type":"FxSpot","uic":21700189}]
#
# TRADING SETTINGS (Optional - defaults provided)
DEFAULT_TIMEFRAME=1Min
DATA_LOOKBACK_DAYS=30
DRY_RUN=True
BACKTEST_MODE=False

# Asset-Class-Specific Position Sizing (SAXO-SPECIFIC)
MAX_POSITION_VALUE_USD=1000.0
MAX_FX_NOTIONAL=10000.0
MAX_PORTFOLIO_EXPOSURE=10000.0

# Risk Management
STOP_LOSS_PCT=2.0
TAKE_PROFIT_PCT=5.0

# Trading Parameters
MIN_TRADE_AMOUNT=100.0
MAX_TRADES_PER_DAY=10

# Trading Hours Configuration (SAXO-SPECIFIC)
TRADING_HOURS_MODE=fixed
MARKET_OPEN_TIME=14:30
MARKET_CLOSE_TIME=21:00
# Legacy aliases also supported: MARKET_OPEN_HOUR, MARKET_CLOSE_HOUR

# Logging
LOG_LEVEL=INFO
ENABLE_NOTIFICATIONS=False

# ============================================================
# Market Data Polling (Optional)
# Minimum delay between calls enforced in data/saxo_client.py
# ============================================================
SAXO_MIN_QUOTES_POLL_SECONDS=5
SAXO_MIN_BARS_POLL_SECONDS=10

# ============================================================
# STRATEGY CONFIGURATION (Epic 004)
# ============================================================

# Strategy Selection
STRATEGY_NAME=moving_average

# Option 1: JSON format (flexible, can specify any parameters)
# STRATEGY_PARAMS_JSON={"short_window": 5, "long_window": 20, "threshold_bps": 50}

# Option 2: Individual parameters (easier for beginners)
STRATEGY_SHORT_WINDOW=5
STRATEGY_LONG_WINDOW=20
# STRATEGY_THRESHOLD_BPS=50  # Optional: Minimum MA separation in basis points (e.g., 50 = 0.5%)
# STRATEGY_COOLDOWN_BARS=10  # Optional: Minimum bars between trades to prevent churn

# Parameter Guidelines:
# - short_window: Typical range 3-10 (shorter = more sensitive)
# - long_window: Typical range 20-50 (longer = smoother)
# - Ensure short_window < long_window
# - threshold_bps: Optional noise filter (0-100 typical)
# - cooldown_bars: Prevents excessive trading in choppy markets
#
# WARNING: Excessive parameter tuning can lead to backtest overfitting.
# Document rationale for parameter changes. Consider out-of-sample validation.
# Reference: https://carmamaths.org/jon/backtest2.pdf

# Data Quality and Market State Policy (Saxo-Aligned)
# =====================================================

# Allow trading during extended hours (PreMarket/PostMarket on Saxo)
# WARNING: Extended hours have:
#   - Lower liquidity (wider spreads)
#   - Higher volatility
#   - Different stop/conditional order behavior
# Reference: https://www.home.saxo/en-gb/legal/risk-warning/saxo-risk-warning
ALLOW_EXTENDED_HOURS=false

# Maximum age of LastUpdated before considered stale (seconds)
# IMPORTANT: Saxo's DelayedByMinutes=0 does NOT guarantee fresh data
#            for illiquid instruments. Always check LastUpdated timestamp.
# Reference: https://openapi.help.saxo/hc/en-us/articles/6105016299677
# Default: 300 seconds (5 minutes)
DATA_STALENESS_THRESHOLD_SECONDS=300

# Require market to be in "Open" state (Saxo MarketState enum) before trading
# Default: true (safe)
# Reference: https://www.developer.saxo/openapi/referencedocs/trade/v1/prices/post__trade__multileg/schema-marketstate
REQUIRE_MARKET_OPEN=true

# SIM ENVIRONMENT ONLY: Allow delayed quotes for development
# Saxo SIM does not offer live pricing for many non-FX instruments.
# This setting allows delayed quotes in SIM to make progress during development,
# but MUST be disabled for LIVE trading.
# Reference: https://openapi.help.saxo/hc/en-us/articles/4416934146449
ALLOW_DELAYED_DATA_IN_SIM=true

# Important Saxo-Specific Notes:
# ===============================
# 1. CryptoFX trades WEEKDAYS ONLY (not 24/7 despite common assumption)
#    Reference: https://www.developer.saxo/openapi/learn/crypto-fx-in-openapi
#
# 2. NoAccess errors require operator action:
#    - SIM: Link Live account to SIM for non-FX market data access
#    - LIVE: Enable market data in SaxoTraderGO
#    Reference: https://openapi.help.saxo/hc/en-us/articles/4405160773661
#
# 3. PriceType "OldIndicative" means market closed / last known price
#    Reference: https://www.developer.saxo/openapi/learn/pricing

# ============================================================
# Security Notes:
# - Never commit actual tokens/secrets to version control
# - Tokens are environment-specific (SIM vs LIVE)
# - Keep credentials secure (treat as passwords)
# - OAuth refresh tokens expire after ~30 days of inactivity
# ============================================================
